<template>
  <div class="body-background">
    <div class="elemental-sequencing">
      <div class="header">
        <div class="header-center">
        <div>
          <svg t="1754157450551" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
            p-id="19603" width="256" height="256">
            <path
              d="M923.5968 773.4272c31.0272-60.2112 48.5888-128.5632 48.5888-200.96 0-242.5344-196.608-439.1424-439.1424-439.1424s-439.1424 196.608-439.1424 439.1424c0 72.448 17.5616 140.7488 48.5888 200.96h781.1072z"
              fill="#108BE9" p-id="19604"></path>
            <path
              d="M351.0784 670.208c5.9904 0 5.9904-9.2672 0-9.2672-5.9392 0-5.9392 9.2672 0 9.2672zM244.7872 324.1472c5.9904 0 5.9904-9.2672 0-9.2672-5.9392 0-5.9392 9.2672 0 9.2672zM563.712 460.0832c5.9904 0 5.9904-9.2672 0-9.2672s-5.9904 9.2672 0 9.2672zM711.9872 274.688c5.9904 0 5.9904-9.2672 0-9.2672-5.9392 0-5.9392 9.2672 0 9.2672zM805.9392 536.7296c5.9904 0 5.9904-9.2672 0-9.2672-5.9392 0-5.9904 9.2672 0 9.2672z"
              fill="#FFFFFF" p-id="19605"></path>
            <path d="M301.6704 480.0512c2.9696 0 2.9696-4.6592 0-4.6592-3.0208 0-3.0208 4.6592 0 4.6592z" fill="#FFFFFF"
              opacity=".48" p-id="19606"></path>
            <path d="M427.7248 759.2448c5.9904 0 5.9904-9.2672 0-9.2672-5.9392-0.0512-5.9904 9.2672 0 9.2672z"
              fill="#FFFFFF" opacity=".16" p-id="19607"></path>
            <path d="M257.1776 694.9376c5.9904 0 5.9904-9.2672 0-9.2672s-5.9904 9.2672 0 9.2672z" fill="#FFFFFF"
              opacity=".16" p-id="19608"></path>
            <path d="M665.0368 484.8128c5.9904 0 5.9904-9.2672 0-9.2672-5.9392 0-5.9904 9.2672 0 9.2672z" fill="#FFFFFF"
              opacity=".16" p-id="19609"></path>
            <path d="M805.9392 769.1264c5.9904 0 5.9904-9.2672 0-9.2672-5.9392 0-5.9904 9.2672 0 9.2672z" fill="#FFFFFF"
              opacity=".16" p-id="19610"></path>
            <path d="M467.3024 489.7792c5.9904 0 5.9904-9.2672 0-9.2672s-5.9904 9.2672 0 9.2672z" fill="#FFFFFF"
              opacity=".16" p-id="19611"></path>
            <path d="M299.1616 232.704c5.9904 0 5.9904-9.2672 0-9.2672-5.9392-0.0512-5.9392 9.2672 0 9.2672z"
              fill="#FFFFFF" opacity=".6" p-id="19612"></path>
            <path d="M383.232 346.368c5.9904 0 5.9904-9.2672 0-9.2672s-5.9904 9.2672 0 9.2672z" fill="#FFFFFF"
              opacity=".6" p-id="19613"></path>
            <path d="M640.3072 203.008c5.9904 0 5.9904-9.2672 0-9.2672-5.9392 0-5.9392 9.2672 0 9.2672z" fill="#FFFFFF"
              opacity=".6" p-id="19614"></path>
            <path d="M852.8896 321.6896c5.9904 0 5.9904-9.2672 0-9.2672-5.9392 0-5.9392 9.2672 0 9.2672z" fill="#FFFFFF"
              opacity=".6" p-id="19615"></path>
            <path d="M798.5152 650.4448c5.9904 0 5.9904-9.2672 0-9.2672-5.9392 0-5.9392 9.2672 0 9.2672z" fill="#FFFFFF"
              opacity=".15" p-id="19616"></path>
            <path d="M437.6064 554.0352c5.9904 0 5.9904-9.2672 0-9.2672-5.9392 0-5.9904 9.2672 0 9.2672z" fill="#FFFFFF"
              opacity=".15" p-id="19617"></path>
            <path d="M190.4128 368.64c5.9904 0 5.9904-9.2672 0-9.2672s-5.9904 9.2672 0 9.2672z" fill="#FFFFFF"
              opacity=".15" p-id="19618"></path>
            <path
              d="M447.488 707.6352s-516.6592-7.424-380.672 79.104c10.1376 6.4512 24.2688 9.4208 35.7888 11.8272 23.04 4.9152 57.4464-5.4272 77.6704 2.9696 32.3072 13.3632-23.5008 53.5552 16.7936 64.4096 116.0704 31.3344 239.3088 28.672 358.6048 25.6 128.9728-3.328 267.9808-21.504 381.2864-87.5008 0.1536-0.1024 135.5776-79.1552-489.472-96.4096z"
              fill="#71E1FF" p-id="19619"></path>
            <path
              d="M448.621268 697.490083a28.0576 28.0576 0 1 0 16.341859-53.682952 28.0576 28.0576 0 1 0-16.341859 53.682952Z"
              fill="#EDCC8C" p-id="19620"></path>
            <path
              d="M635.4432 598.272s69.0688 58.9824 170.496 72.3456c-39.5776 28.0576-166.8608 56.3712-334.1824 41.1648C413.7984 706.56 397.824 491.0592 397.824 491.0592c-0.4608-52.8384 42.0352-96.0512 94.8736-96.512 52.8384-0.4608 75.3152 22.0672 91.5456 41.3696 64.6656 76.8512 51.2 162.3552 51.2 162.3552z"
              fill="#FFFFFF" p-id="19621"></path>
            <path
              d="M441.856 628.992s-22.528 58.88-47.0016 45.056l0.8192 99.5328 201.6256-1.6896-0.8192-98.2528s-50.176-14.8992-51.8656-50.5856L441.856 628.992z"
              fill="#CE5451" p-id="19622"></path>
            <path
              d="M428.032 492.8512s13.9264 14.848 7.424 63.9488c0 0-11.1104 33.3824 7.424 64.8704 0 0 16.6912 32.4608-1.8432 61.184l29.6448-7.424c18.5344-28.7232 1.8432-61.184 1.8432-61.184-18.5344-31.5392-7.424-64.8704-7.424-64.8704 6.5024-49.152-7.424-63.9488-7.424-63.9488L428.032 492.8512zM562.7904 492.8512s-13.9264 14.848-7.424 63.9488c0 0 11.1104 33.3824-7.424 64.8704 0 0-16.6912 32.4608 1.8432 61.184l-29.6448-7.424c-18.5344-28.7232-1.8432-61.184-1.8432-61.184 18.5344-31.5392 7.424-64.8704 7.424-64.8704-6.5024-49.152 7.424-63.9488 7.424-63.9488l29.6448 7.424z"
              fill="#71E1FF" p-id="19623"></path>
            <path
              d="M560.1792 665.7024l-1.024-3.328c-1.8944-6.0416-8.8064-6.2976-12.4416-3.1744-37.888-5.12-75.9296 2.8672-113.9712-1.28-9.472-1.024-9.4208 13.824 0 14.848 39.424 4.3008 79.1552-5.3248 118.3744 2.0992 5.2224 0.9728 10.9056-3.3792 9.0624-9.1648z"
              fill="#71E1FF" p-id="19624"></path>
            <path
              d="M614.3488 888.064c16.0768-12.3392-20.992-8.6528-20.992-8.6528-9.8816-7.424 16.0768-13.6192 16.0768-13.6192 7.424-8.6528-20.992-6.1952-20.992-6.1952-9.8816-13.6192 22.272-12.3392 22.272-12.3392 14.848-17.3056-19.7632-13.6192-19.7632-13.6192-12.3392-9.8816 14.848-9.8816 14.848-9.8816 13.6192-14.848-13.6192-8.6528-13.6192-8.6528-22.272-7.424 6.1952-14.848 6.1952-14.848 17.3056-8.6528 3.6864-16.0768 3.6864-16.0768-11.1104-3.6864-4.8128-14.3872-4.8128-14.3872l-201.472 3.6864s-6.2976 10.7008 4.8128 14.3872c0 0 13.6192 7.424-3.6864 16.0768 0 0-28.416 7.424-6.1952 14.848 0 0 27.1872-6.1952 13.6192 8.6528 0 0-27.1872 0-14.848 9.8816 0 0 34.6112-3.6864 19.7632 13.6192 0 0-32.1536-1.2288-22.272 12.3392 0 0 28.416-2.4576 20.992 6.1952 0 0-25.9584 6.1952-16.0768 13.6192 0 0 37.0688-3.6864 20.992 8.6528"
              fill="#CE5451" opacity=".92" p-id="19625"></path>
            <path
              d="M592.4864 779.6224c-32.4096 4.5568-25.8048-43.264-23.6544-63.1296 1.8944-17.5616 5.3248-34.6624-0.512-51.8144-1.3824-4.0448-5.0176-5.4784-8.2944-5.0176-0.6144-1.4848-1.7408-2.6624-3.2256-3.584-0.5632-3.2768-3.3792-6.3488-7.2704-6.656-4.096-0.3072-8.1408-0.4608-12.2368-0.4608-2.56-0.9216-4.9664-1.8432-6.2976-2.048-2.9184-0.4608-5.8368-0.5632-8.8064-0.4096-9.1648 0.4608-17.9712 3.2256-27.0848 4.1984-3.0208 0.3584-5.0688 2.0992-6.144 4.352-0.4096-0.4608-0.8192-0.8704-1.3824-1.2288-1.1776-0.8704-2.5088-1.4336-3.84-1.8432-1.4848-0.6144-2.9696-1.1264-4.5568-1.5872-2.2016-0.6144-4.096-0.2048-5.632 0.7168-3.328 0.2048-6.656 0.512-9.728 0.3072-9.0624-0.6144-17.2544-3.7888-25.7024 0.9216-1.9456 1.1264-3.0208 2.7136-3.3792 4.352-3.6864-1.28-8.0896-0.0512-9.0624 4.864-4.9152 23.8592-8.704 47.872-11.1104 72.1408-1.1776 11.6224-1.536 23.3472-2.7648 34.9696-1.3312 12.5952-0.7168 19.4048-13.1072 25.8048-1.9968 1.024-5.2736 1.6896-7.3728 2.6112-8.704 3.8912-1.1776 16.64 7.4752 12.8 6.9632-3.072 13.2096-1.7408 18.7904-8.1408 7.3216-8.448 8.0384-22.5792 9.0624-33.1264 1.9968-20.8384 3.9424-41.472 6.656-62.1056-3.4304-12.4928-5.1712-25.2416-3.072-38.3488 0.9216-5.632 7.1168-5.6832 10.4448-2.4576 0.3584-0.256 0.768-0.512 1.1776-0.7168 3.8912-2.0992 7.5776 0.1536 9.0112 3.2768 0.6656-1.2288 1.0752-2.6112 1.0752-3.9936 4.1472 0.3584 8.8064 1.7408 11.9296 1.9456 3.2256 0.2048 9.9328-1.2288 14.0288-0.4608 0.0512 0.256 0.0512 0.512 0.1024 0.7168 1.0752 3.8912 5.2224 6.1952 9.1136 5.1712 3.7888-0.9728 7.0656-1.28 11.1104-1.1264 3.84 0.1536 7.0656-3.2256 7.3728-6.912 1.3824-0.3072 2.816-0.5632 4.2496-0.8704 1.5872 1.4848 3.84 2.4064 6.4512 2.048 2.1504-0.3072 4.3008-0.512 6.5024-0.6656 15.7184-3.0208 33.4848-6.7584 37.2736 13.2608 2.816 15.0528-4.096 32.256-4.608 47.2064-0.6144 17.6128 1.5872 35.2256 2.56 52.8384 5.5296 12.3392 16.7936 19.4048 38.5024 16.3328 9.2672-1.1776 5.2736-15.4624-4.0448-14.1312z"
              fill="#71E1FF" p-id="19626"></path>
            <path
              d="M550.4512 742.5536H439.0912c-4.9152 0-8.9088-3.9936-8.9088-8.9088v-70.144c0-0.4096 0.3072-0.7168 0.7168-0.7168h127.744c0.4096 0 0.7168 0.3072 0.7168 0.7168v70.144c0 4.9152-3.9936 8.9088-8.9088 8.9088z"
              fill="#E26969" p-id="19627"></path>
            <path
              d="M936.96 804.0448c-111.9232 68.4032-252.3136 84.224-381.2864 87.5008-119.296 3.072-242.5344 5.7856-358.6048-25.6-22.3232-6.0416-15.1552-21.0432-9.8304-35.4816 0 0 820.1728 61.9008 712.6528-77.1072 0 0 81.5616 23.5008 37.0688 50.688z"
              fill="#4AB8D1" opacity=".46" p-id="19628"></path>
            <path
              d="M353.8944 337.2544c-7.424 9.472-17.5104 16.9984-29.6448 21.4016-34.6624 12.544-72.9088-5.376-85.4528-39.9872-10.752-29.6448 0.8192-61.9008 26.112-78.4384-13.7728 17.5104-18.4832 41.5232-10.3424 64 12.544 34.6112 50.7904 52.5312 85.4016 39.9872 5.0176-1.8432 9.6256-4.1984 13.9264-6.9632z"
              fill="#FFFFFF" p-id="19629"></path>
            <path
              d="M756.736 729.6s57.6512 19.9168 91.1872 11.8784c0 0 21.9648-4.4544 27.904-12.8 0 0 10.3936-15.1552 11.5712-29.1328 0 0-1.792 58.2144-76.6464 61.184 0 0-21.4016 2.9696-39.8336 3.584L756.736 729.6z"
              fill="#DBA731" p-id="19630"></path>
            <path
              d="M756.4288 729.344l33.28 0.6144s40.3968-12.8 74.8544-19.3024l22.8864-10.0864s-3.2768 18.432-11.5712 29.1328c-0.0512-0.1024-33.3312 32.6144-119.4496-0.3584z"
              fill="#F7C469" p-id="19631"></path>
            <path
              d="M864.256 711.7824l16.0256 5.0688s-5.0688 10.7008-6.8096 10.0864l-26.4192-10.0864s15.7184-4.1472 17.2032-5.0688zM841.984 718.0288l28.8256 11.264s-12.1856 8.9088-29.696 11.8784l-30.8736-14.2848 31.744-8.8576zM794.7264 730.2144l10.7008-2.3552 25.2416 12.7488-18.1248 1.1776zM790.8864 730.2144s-12.4928 1.4848-16.9472 1.1776c0 0 22.272 9.5232 34.1504 9.7792l-17.2032-10.9568zM770.9696 764.3648l-14.5408-35.0208 4.1472 1.7408 15.7696 32.9728z"
              fill="#BC8224" p-id="19632"></path>
          </svg>
        </div>
        <h1>404</h1>
        </div>
        <p>哎呀！您访问的页面好像迷失在数字世界中。不过别担心，您可以在下面玩一个小游戏打发时间！</p>
      </div>

      <div class="content">
        <div class="game-container">
          <div class="game-title">
            <i class="fas fa-dragon"></i>
            <h2>恐龙冒险</h2>
            <button @click="isDayTime = !isDayTime" class="btn btn-theme">
              <i :class="isDayTime ? 'fas fa-moon' : 'fas fa-sun'"></i>
              {{ isDayTime ? '夜晚模式' : '白天模式' }}
            </button>
          </div>

          <div class="game-canvas-container">
            <canvas id="gameCanvas" width="800" height="300"></canvas>
            <div id="gameOver" class="game-over">
              <h3>游戏结束!</h3>
              <p>得分: <span id="finalScore">0</span></p>
              <button class="btn btn-restart pulse" @click="restartGame">
                <i class="fas fa-redo"></i> 重新开始
              </button>
            </div>
          </div>

          <div class="game-controls">
            <div class="score-board">
              <div>得分: <span id="score">0</span></div>
              <div>最高分: <span id="highScore">0</span></div>
            </div>

            <div class="controls">
              <button class="btn" @click="startGame" v-if="!gameStarted">
                <i class="fas fa-play"></i> 开始游戏
              </button>
              <button class="btn btn-restart" @click="restartGame" v-else>
                <i class="fas fa-redo"></i> 重新开始
              </button>
              <button class="btn" @click="togglePause" v-if="gameStarted">
                <i class="fas" :class="paused ? 'fa-play' : 'fa-pause'"></i>
                {{ paused ? '继续' : '暂停' }}
              </button>
            </div>
          </div>
        </div>

        <div class="info-card">
          <h3><i class="fas fa-info-circle"></i> 游戏指南</h3>
          <ul class="info-list">
            <li>
              <i class="fas fa-space-shuttle"></i>
              <span>按<strong>空格键</strong>或<strong>上箭头</strong>使恐龙跳跃</span>
            </li>
            <li>
              <i class="fas fa-running"></i>
              <span>躲避仙人掌和其他障碍物</span>
            </li>
            <li>
              <i class="fas fa-stopwatch"></i>
              <span>生存时间越长，得分越高</span>
            </li>
            <li>
              <i class="fas fa-trophy"></i>
              <span>挑战自己，打破最高分记录</span>
            </li>
          </ul>

          <div style="margin-top: 30px;">
            <h3><i class="fas fa-lightbulb"></i> 小贴士</h3>
            <p style="margin-top: 15px; line-height: 1.6; opacity: 0.9;">
              这个页面实际上不存在，但您可以通过导航菜单或以下按钮返回网站：
            </p>
          </div>
        </div>
      </div>

      <div class="footer">
        <div class="action-btn" @click="goHome">
          <i class="fas fa-home"></i>
          <span>返回首页</span>
        </div>
        <div class="action-btn" @click="goBack">
          <i class="fas fa-arrow-left"></i>
          <span>返回上一页</span>
        </div>
        <div class="action-btn" @click="contactSupport">
          <i class="fas fa-headset"></i>
          <span>联系支持</span>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { useRouter } from 'vue-router';

const router = useRouter();
// 按钮点击事件
const goHome = () => {
  router.push('/systemhomeView');
};
const goBack = () => {
  router.back();
};
// 游戏状态
const gameStarted = ref(false);
const paused = ref(false);
const score = ref(0);
const highScore = ref(0);
const isDayTime = ref(true); // 白天/黑夜模式切换

// 游戏变量
let canvas, ctx;
let dino, obstacles = [];
let gameSpeed = 16;
let gravity = 0.5;
let isJumping = false;
let jumpForce = 0;
let gameRunning = false;
let animationId;
let frameCount = 0;
let dinoFrame = 0; // 恐龙动画帧
let cloudPositions = []; // 云朵位置
let stars = []; // 星星位置
let groundOffset = 0; // 地面滚动偏移

// 初始化游戏
const initGame = () => {
  canvas = document.getElementById('gameCanvas');
  ctx = canvas.getContext('2d');

  // 初始化云朵位置
  cloudPositions = [];
  for (let i = 0; i < 5; i++) {
    cloudPositions.push({
      x: Math.random() * canvas.width,
      y: Math.random() * 100 + 20,
      size: Math.random() * 30 + 20,
      speed: Math.random() * 0.5 + 0.2
    });
  }

  // 初始化星星
  stars = [];
  for (let i = 0; i < 50; i++) {
    stars.push({
      x: Math.random() * canvas.width,
      y: Math.random() * 150,
      size: Math.random() * 1.5 + 0.5,
      alpha: Math.random() * 0.5 + 0.5
    });
  }

  // 初始化恐龙
  dino = {
    x: 50,
    y: canvas.height - 70, // 调整初始位置
    width: 50,
    height: 60,
    frame: 0,
    jumpFrame: 0,
    isBlinking: false,
    blinkTimer: 0,

    // 身体各部分颜色
    colors: {
      body: '#4ecdc4',
      belly: '#3da89a',
      eyeWhite: 'white',
      eyePupil: 'black',
      eyeHighlight: 'rgba(255, 255, 255, 0.8)',
      leg: '#3da89a',
      tail: '#3da89a',
      mouth: '#ff7043'
    },

    // 身体各部分尺寸
    dimensions: {
      headWidth: 30,
      headHeight: 25,
      bodyWidth: 40,
      bodyHeight: 35,
      legWidth: 12,
      legHeight: 18,
      tailLength: 25,
      eyeSize: 6,
      pupilSize: 3
    },

    draw() {
      const bodyY = this.y + this.dimensions.headHeight;

      // 保存当前画布状态
      ctx.save();

      // 绘制尾巴 (动态摆动)
      ctx.strokeStyle = this.colors.tail;
      ctx.lineWidth = 6;
      ctx.lineCap = 'round';
      ctx.beginPath();
      const tailAngle = Math.sin(this.frame * 0.15) * 0.2;
      const tailBaseX = this.x - 5;
      const tailBaseY = bodyY + this.dimensions.bodyHeight - 5;
      ctx.moveTo(tailBaseX, tailBaseY);

      // 三次贝塞尔曲线实现更自然的尾巴摆动
      ctx.bezierCurveTo(
        tailBaseX - this.dimensions.tailLength / 2 + Math.sin(this.frame * 0.1) * 5,
        tailBaseY - 10 + Math.sin(this.frame * 0.2) * 3,
        tailBaseX - this.dimensions.tailLength + Math.sin(this.frame * 0.15) * 8,
        tailBaseY - 5 + Math.sin(this.frame * 0.25) * 4,
        tailBaseX - this.dimensions.tailLength - 5 + Math.sin(this.frame * 0.1) * 10,
        tailBaseY + Math.sin(this.frame * 0.3) * 5
      );
      ctx.stroke();

      // 绘制身体 (椭圆形状)
      ctx.fillStyle = this.colors.body;
      ctx.beginPath();
      ctx.ellipse(
        this.x + this.dimensions.bodyWidth / 2,
        bodyY + this.dimensions.bodyHeight / 2,
        this.dimensions.bodyWidth / 2,
        this.dimensions.bodyHeight / 2,
        0, 0, Math.PI * 2
      );
      ctx.fill();

      // 绘制腹部 (更浅的颜色)
      ctx.fillStyle = this.colors.belly;
      ctx.beginPath();
      ctx.ellipse(
        this.x + this.dimensions.bodyWidth / 2,
        bodyY + this.dimensions.bodyHeight / 2 + 5,
        this.dimensions.bodyWidth / 2 - 5,
        this.dimensions.bodyHeight / 2 - 8,
        0, 0, Math.PI * 2
      );
      ctx.fill();

      // 绘制头部 (与身体分离)
      ctx.fillStyle = this.colors.body;
      ctx.beginPath();
      ctx.ellipse(
        this.x + this.dimensions.headWidth + 5,
        this.y + this.dimensions.headHeight / 2,
        this.dimensions.headWidth / 2,
        this.dimensions.headHeight / 2,
        0, 0, Math.PI * 2
      );
      ctx.fill();

      // 绘制嘴巴 (动态开合)
      const mouthOpenness = isJumping ?
        Math.min(0.5 + this.jumpFrame * 0.02, 0.7) :
        Math.sin(this.frame * 0.2) * 0.2 + 0.3;

      ctx.fillStyle = this.colors.mouth;
      ctx.beginPath();
      ctx.ellipse(
        this.x + this.dimensions.headWidth + 12,
        this.y + this.dimensions.headHeight / 2 + 3,
        8,
        mouthOpenness * 5,
        0, 0, Math.PI
      );
      ctx.fill();

      // 随机眨眼
      if (Math.random() < 0.005 && !this.isBlinking) {
        this.isBlinking = true;
        this.blinkTimer = 5;
      }

      // 绘制眼睛
      const eyeY = this.y + this.dimensions.headHeight / 2 - 3;
      const eyeX = this.x + this.dimensions.headWidth;

      if (!this.isBlinking || Math.floor(this.frame) % 2 === 0) {
        // 眼白
        ctx.fillStyle = this.colors.eyeWhite;
        ctx.beginPath();
        ctx.arc(eyeX, eyeY, this.dimensions.eyeSize, 0, Math.PI * 2);
        ctx.fill();

        // 瞳孔 (看向跳跃方向)
        const pupilOffset = isJumping ?
          (this.jumpForce > 0 ? -2 : 2) :
          Math.sin(this.frame * 0.1) * 1.5;

        ctx.fillStyle = this.colors.eyePupil;
        ctx.beginPath();
        ctx.arc(
          eyeX + pupilOffset,
          eyeY,
          this.dimensions.pupilSize,
          0, Math.PI * 2
        );
        ctx.fill();

        // 眼睛高光
        ctx.fillStyle = this.colors.eyeHighlight;
        ctx.beginPath();
        ctx.arc(
          eyeX + pupilOffset - 1,
          eyeY - 1,
          1,
          0, Math.PI * 2
        );
        ctx.fill();
      }

      // 更新眨眼计时器
      if (this.isBlinking) {
        this.blinkTimer--;
        if (this.blinkTimer <= 0) {
          this.isBlinking = false;
        }
      }

      // 绘制腿部 (更复杂的动画)
      const legAngle = Math.sin(this.frame * 0.3) * 0.4;
      const legLift = isJumping ? 0 : Math.abs(Math.sin(this.frame * 0.3)) * 5;

      // 后腿
      ctx.save();
      ctx.translate(
        this.x + this.dimensions.bodyWidth - 5,
        bodyY + this.dimensions.bodyHeight - 5
      );
      ctx.rotate(legAngle);
      ctx.fillStyle = this.colors.leg;
      ctx.beginPath();
      ctx.roundRect(0, -legLift, this.dimensions.legWidth, this.dimensions.legHeight, 5);
      ctx.fill();
      ctx.restore();

      // 前腿
      ctx.save();
      ctx.translate(
        this.x + 10,
        bodyY + this.dimensions.bodyHeight - 5
      );
      ctx.rotate(-legAngle * 0.8);
      ctx.fillStyle = this.colors.leg;
      ctx.beginPath();
      ctx.roundRect(0, -legLift * 0.7, this.dimensions.legWidth, this.dimensions.legHeight, 5);
      ctx.fill();
      ctx.restore();

      // 绘制脚趾
      const toePositions = [
        { x: 2, y: this.dimensions.legHeight - 2 },
        { x: 6, y: this.dimensions.legHeight + 3 },
        { x: 10, y: this.dimensions.legHeight - 2 }
      ];

      ctx.fillStyle = '#2a8a7f';
      toePositions.forEach(pos => {
        // 后脚脚趾
        ctx.beginPath();
        ctx.arc(
          this.x + this.dimensions.bodyWidth - 5 + pos.x,
          bodyY + this.dimensions.bodyHeight + this.dimensions.legHeight - 5 + pos.y,
          2, 0, Math.PI * 2
        );
        ctx.fill();

        // 前脚脚趾
        ctx.beginPath();
        ctx.arc(
          this.x + 10 + pos.x,
          bodyY + this.dimensions.bodyHeight + this.dimensions.legHeight - 5 + pos.y * 0.8,
          2, 0, Math.PI * 2
        );
        ctx.fill();
      });

      // 更新帧计数器
      this.frame += 0.1;
      if (isJumping) this.jumpFrame += 1;
      else this.jumpFrame = 0;

      // 恢复画布状态
      ctx.restore();
    }
  };

  obstacles = [];
  score.value = 0;
  gameSpeed = 2;
  frameCount = 0;
  groundOffset = 0;
};

// 绘制地面
const drawGround = () => {
  // 地面阴影
  ctx.fillStyle = isDayTime.value ? 'rgba(0, 0, 0, 0.1)' : 'rgba(0, 0, 0, 0.3)';
  ctx.fillRect(0, canvas.height - 10, canvas.width, 10);

  // 地面主体
  ctx.fillStyle = isDayTime.value ? '#5d4037' : '#3e2723';
  ctx.fillRect(0, canvas.height - 15, canvas.width, 15);

  // 草地纹理
  ctx.fillStyle = isDayTime.value ? '#7cb342' : '#5a9216';
  for (let x = -groundOffset % 30; x < canvas.width; x += 30) {
    ctx.beginPath();
    ctx.moveTo(x, canvas.height - 15);
    ctx.lineTo(x + 15, canvas.height - 20);
    ctx.lineTo(x + 30, canvas.height - 15);
    ctx.fill();
  }

  groundOffset += gameSpeed;
};

// 绘制背景
const drawBackground = () => {
  // 渐变天空
  const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
  if (isDayTime.value) {
    gradient.addColorStop(0, '#64b3f4');
    gradient.addColorStop(1, '#c2e59c');
  } else {
    gradient.addColorStop(0, '#0f2027');
    gradient.addColorStop(1, '#203a43');
  }
  ctx.fillStyle = gradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // 绘制星星 (夜晚模式)
  if (!isDayTime.value) {
    stars.forEach(star => {
      ctx.fillStyle = `rgba(255, 255, 255, ${star.alpha})`;
      ctx.beginPath();
      ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
      ctx.fill();
    });
  }

  // 绘制云朵
  ctx.fillStyle = isDayTime.value ? 'rgba(255, 255, 255, 0.7)' : 'rgba(200, 200, 200, 0.5)';
  cloudPositions.forEach(cloud => {
    cloud.x -= cloud.speed;
    if (cloud.x + cloud.size * 3 < 0) {
      cloud.x = canvas.width;
    }

    ctx.beginPath();
    ctx.arc(cloud.x, cloud.y, cloud.size * 0.7, 0, Math.PI * 2);
    ctx.arc(cloud.x + cloud.size * 0.6, cloud.y - cloud.size * 0.2, cloud.size * 0.8, 0, Math.PI * 2);
    ctx.arc(cloud.x + cloud.size * 1.3, cloud.y, cloud.size * 0.7, 0, Math.PI * 2);
    ctx.fill();
  });

  // 绘制远处山脉
  ctx.fillStyle = isDayTime.value ? 'rgba(0, 0, 0, 0.1)' : 'rgba(0, 0, 0, 0.3)';
  ctx.beginPath();
  ctx.moveTo(0, canvas.height - 50);
  for (let x = 0; x < canvas.width; x += 50) {
    const height = Math.sin(x * 0.01) * 20 + 30;
    ctx.lineTo(x, canvas.height - 50 - height);
  }
  ctx.lineTo(canvas.width, canvas.height);
  ctx.lineTo(0, canvas.height);
  ctx.closePath();
  ctx.fill();
};

// 绘制仙人掌
const drawCactus = (x, height) => {
  // 仙人掌阴影
  ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
  ctx.fillRect(x + 3, canvas.height - 15 - height + 3, 20, height);

  // 仙人掌主体
  const cactusColor = isDayTime.value ? '#2e7d32' : '#1b5e20';
  ctx.fillStyle = cactusColor;
  ctx.beginPath();
  ctx.roundRect(x, canvas.height - 15 - height, 20, height, 5);
  ctx.fill();

  // 仙人掌纹理
  ctx.strokeStyle = isDayTime.value ? '#1b5e20' : '#003300';
  ctx.lineWidth = 2;
  for (let y = canvas.height - 15 - height + 10; y < canvas.height - 15; y += 10) {
    ctx.beginPath();
    ctx.moveTo(x + 3, y);
    ctx.lineTo(x + 17, y);
    ctx.stroke();
  }

  // 添加仙人掌刺
  ctx.fillStyle = cactusColor;
  if (height > 40) {
    // 主刺
    ctx.beginPath();
    ctx.roundRect(x - 8, canvas.height - 15 - height + 20, 36, 8, 4);
    ctx.fill();

    // 小刺
    ctx.beginPath();
    ctx.roundRect(x - 5, canvas.height - 15 - height + 40, 30, 6, 3);
    ctx.fill();
  }

  // 仙人掌顶部花朵 (随机)
  if (Math.random() > 0.7) {
    ctx.fillStyle = '#ff0000';
    ctx.beginPath();
    ctx.arc(x + 10, canvas.height - 15 - height - 5, 5, 0, Math.PI * 2);
    ctx.fill();
  }
};

// 绘制月亮/太阳
const drawCelestialBody = () => {
  if (isDayTime.value) {
    // 绘制太阳
    ctx.fillStyle = '#ffeb3b';
    ctx.beginPath();
    ctx.arc(canvas.width - 100, 80, 30, 0, Math.PI * 2);
    ctx.fill();

    // 太阳光芒
    ctx.strokeStyle = 'rgba(255, 235, 59, 0.5)';
    ctx.lineWidth = 3;
    for (let i = 0; i < 12; i++) {
      const angle = (i / 12) * Math.PI * 2;
      ctx.beginPath();
      ctx.moveTo(
        canvas.width - 100 + Math.cos(angle) * 30,
        80 + Math.sin(angle) * 30
      );
      ctx.lineTo(
        canvas.width - 100 + Math.cos(angle) * 45,
        80 + Math.sin(angle) * 45
      );
      ctx.stroke();
    }
  } else {
    // 绘制月亮
    ctx.fillStyle = '#e0e0e0';
    ctx.beginPath();
    ctx.arc(canvas.width - 100, 80, 25, 0, Math.PI * 2);
    ctx.fill();

    // 月亮阴影
    ctx.fillStyle = '#203a43';
    ctx.beginPath();
    ctx.arc(canvas.width - 110, 75, 20, 0, Math.PI * 2);
    ctx.fill();
  }
};

// 游戏主循环
const gameLoop = () => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  drawBackground();
  drawCelestialBody();
  drawGround();

  // 更新和绘制恐龙
  if (isJumping) {
    dino.y -= jumpForce;
    jumpForce -= gravity;

    if (dino.y >= canvas.height - 60) {
      dino.y = canvas.height - 60;
      isJumping = false;

      // 落地灰尘效果
      ctx.fillStyle = 'rgba(200, 200, 200, 0.5)';
      for (let i = 0; i < 5; i++) {
        const size = Math.random() * 5 + 3;
        ctx.beginPath();
        ctx.arc(
          dino.x + Math.random() * dino.width,
          canvas.height - 10,
          size, 0, Math.PI * 2
        );
        ctx.fill();
      }
    }
  }

  dino.draw();

  // 生成障碍物
  if (frameCount % Math.max(30, 100 - Math.min(score.value, 50)) === 0) {
    const height = Math.random() * 40 + 30;
    const width = 20 + Math.random() * 10;
    obstacles.push({
      x: canvas.width,
      height: height,
      width: width,
      passed: false
    });
  }

  // 更新和绘制障碍物
  for (let i = 0; i < obstacles.length; i++) {
    const cactus = obstacles[i];
    cactus.x -= gameSpeed;

    drawCactus(cactus.x, cactus.height);

    // 碰撞检测
    if (
      dino.x + dino.width > cactus.x &&
      dino.x < cactus.x + cactus.width &&
      dino.y + dino.height > canvas.height - 15 - cactus.height
    ) {
      // 碰撞效果
      ctx.fillStyle = 'rgba(255, 0, 0, 0.5)';
      ctx.beginPath();
      ctx.arc(
        (dino.x + dino.width + cactus.x) / 2,
        (dino.y + canvas.height - 15 - cactus.height) / 2,
        30, 0, Math.PI * 2
      );
      ctx.fill();

      endGame();
      return;
    }

    // 计分
    if (!cactus.passed && cactus.x + cactus.width < dino.x) {
      cactus.passed = true;
      score.value += 1;

      // 分数增加效果
      ctx.fillStyle = '#4CAF50';
      ctx.font = '20px Arial';
      ctx.fillText('+1', dino.x + 20, dino.y - 10);

      // 每10分增加速度
      if (score.value % 10 === 0) {
        gameSpeed += 0.5;

        // 速度变化效果
        ctx.fillStyle = '#FFC107';
        ctx.font = 'bold 24px Arial';
        ctx.fillText('速度提升!', canvas.width / 2 - 60, 50);

        // 白天/黑夜切换
        if (score.value % 30 === 0) {
          isDayTime.value = !isDayTime.value;
        }
      }
    }

    // 移除屏幕外的障碍物
    if (cactus.x + cactus.width < 0) {
      obstacles.splice(i, 1);
      i--;
    }
  }

  // 显示分数
  ctx.fillStyle = isDayTime.value ? '#333' : '#fff';
  ctx.font = 'bold 24px Arial';
  ctx.textAlign = 'right';
  ctx.fillText(`分数: ${score.value}`, canvas.width - 20, 40);
  ctx.fillText(`最高分: ${highScore.value}`, canvas.width - 20, 70);

  frameCount++;
  if (gameRunning && !paused.value) {
    animationId = requestAnimationFrame(gameLoop);
  }
};

// 开始游戏
const startGame = () => {
  if (!gameStarted.value) {
    gameStarted.value = true;
  }

  if (!gameRunning) {
    gameRunning = true;
    paused.value = false;
    document.getElementById('gameOver').classList.remove('show');
    gameLoop();
  }
};

// 暂停/继续游戏
const togglePause = () => {
  if (!gameRunning) return;

  paused.value = !paused.value;

  if (!paused.value) {
    gameLoop();
  }
};

// 重新开始游戏
const restartGame = () => {
  cancelAnimationFrame(animationId);
  gameRunning = false;
  initGame();
  startGame();
};

// 结束游戏
const endGame = () => {
  gameRunning = false;
  document.getElementById('finalScore').textContent = score.value;
  document.getElementById('gameOver').classList.add('show');

  // 更新最高分
  if (score.value > highScore.value) {
    highScore.value = score.value;
    document.getElementById('highScore').textContent = highScore.value;

    // 新纪录效果
    ctx.fillStyle = '#FF5722';
    ctx.font = 'bold 30px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('新纪录!', canvas.width / 2, canvas.height / 2 - 30);
  }

  // 游戏结束效果
  ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = '#fff';
  ctx.font = 'bold 36px Arial';
  ctx.textAlign = 'center';
  ctx.fillText('游戏结束', canvas.width / 2, canvas.height / 2 - 50);
  ctx.font = '24px Arial';
  ctx.fillText(`最终分数: ${score.value}`, canvas.width / 2, canvas.height / 2);
};

// 跳跃函数
const jump = () => {
  if (!gameRunning || paused.value) return;

  if (!isJumping) {
    isJumping = true;
    jumpForce = 15;

    // 跳跃音效 (实际项目中可以取消注释)
    // const jumpSound = new Audio('jump.mp3');
    // jumpSound.play();
  }
};

// 键盘事件监听
const handleKeyDown = (e) => {
  if (e.code === 'Space' || e.key === ' ' || e.key === 'ArrowUp') {
    e.preventDefault();
    jump();
  }
};

// 初始化
onMounted(() => {
  initGame();
  document.addEventListener('keydown', handleKeyDown);
  document.getElementById('gameCanvas').addEventListener('click', jump);
});
</script>

<style scoped>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.body-background {
  background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
  min-height: 100vh;
  overflow-x: hidden;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

@keyframes gradientBG {
  0% {
    background-position: 0% 50%;
  }

  50% {
    background-position: 100% 50%;
  }

  100% {
    background-position: 0% 50%;
  }
}

.elemental-sequencing {
  width: 100%;
  max-width: 1200px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 30px;
}

.header {
  text-align: center;
  padding: 20px;
  width: 100%;
}

.header h1 {
  font-size: 8rem;
  font-weight: 900;
  margin-bottom: 10px;
  text-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
  background: linear-gradient(45deg, #ff9a9e, #fad0c4, #a1c4fd);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  animation: shine 3s infinite;
}
.header-center {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
}
@keyframes shine {
  0% {
    background-position: 0% 50%;
  }

  50% {
    background-position: 100% 50%;
  }

  100% {
    background-position: 0% 50%;
  }
}

.header p {
  font-size: 1.5rem;
  max-width: 700px;
  margin: 0 auto;
  line-height: 1.6;
  opacity: 0.9;
}

.content {
  display: flex;
  flex-wrap: wrap;
  gap: 30px;
  width: 100%;
  justify-content: center;
}

.game-container {
  flex: 1;
  min-width: 500px;
  background: rgba(0, 0, 0, 0.25);
  border-radius: 20px;
  backdrop-filter: blur(10px);
  padding: 20px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  flex-direction: column;
  align-items: center;
}

.game-title {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 20px;
  width: 100%;
  justify-content: center;
}

.game-title h2 {
  font-size: 2rem;
  font-weight: 700;
  color: #fff;
}

.game-title i {
  font-size: 1rem;
  color: #4ecdc4;
}

.game-canvas-container {
  position: relative;
  width: 100%;
  height: 300px;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 15px;
  overflow: hidden;
  border: 2px solid rgba(255, 255, 255, 0.1);
}

.game-controls {
  display: flex;
  justify-content: space-between;
  width: 100%;
  margin-top: 20px;
}

.score-board {
  background: rgba(0, 0, 0, 0.4);
  padding: 10px 20px;
  border-radius: 10px;
  font-weight: 600;
  display: flex;
  gap: 20px;
  color: #fff;
}

.controls {
  display: flex;
  gap: 10px;
}

.btn {
  background: linear-gradient(45deg, #ff6b6b, #ff8e53);
  border: none;
  color: white;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

.btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
}

.btn:active {
  transform: translateY(1px);
}

.btn-restart {
  background: linear-gradient(45deg, #4ecdc4, #1a936f);
}

.btn-theme {
  background: linear-gradient(45deg, #673ab7, #9c27b0);
  margin-left: auto;
}

.game-over {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 10;
  color: white;
  font-size: 2rem;
  font-weight: bold;
  text-align: center;
  display: none;
}

.game-over.show {
  display: flex;
}

.game-over p {
  margin: 20px 0;
  font-size: 1.5rem;
}

.pulse {
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(1.05);
  }

  100% {
    transform: scale(1);
  }
}

@media (max-width: 768px) {
  .game-container {
    min-width: 100%;
  }

  .game-title {
    flex-wrap: wrap;
    justify-content: center;
  }

  .btn-theme {
    margin-left: 0;
    margin-top: 10px;
  }
}

.info-card h3 {
  font-size: 1.8rem;
  margin-bottom: 20px;
  color: #ffd166;
  display: flex;
  align-items: center;
  gap: 10px;
}

.info-list {
  list-style: none;
}

.info-list li {
  padding: 15px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  align-items: center;
  gap: 15px;
}

.info-list li:last-child {
  border-bottom: none;
}

.info-list i {
  width: 30px;
  height: 30px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
  color: #ffd166;
}

.footer {
  display: flex;
  gap: 20px;
  margin-top: 20px;
  flex-wrap: wrap;
}

.action-btn {
  flex: 1;
  min-width: 200px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  padding: 10px;
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 15px;
  transition: all 0.3s ease;
  cursor: pointer;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.action-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-5px);
}

.action-btn i {
  font-size: 1rem;
  color: #ffd166;
}

.action-btn span {
  font-size: 1.1rem;
  font-weight: 600;
}

.game-over {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 10;
  color: white;
  font-size: 2rem;
  font-weight: bold;
  text-align: center;
  display: none;
}

.game-over.show {
  display: flex;
}

.game-over p {
  margin: 20px 0;
  font-size: 1.5rem;
}

.pulse {
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(1.05);
  }

  100% {
    transform: scale(1);
  }
}

@media (max-width: 768px) {
  .content {
    flex-direction: column;
  }

  .game-container {
    min-width: 100%;
  }

  .header h1 {
    font-size: 3.5rem;
  }

  .header p {
    font-size: 1.2rem;
  }
}
</style>